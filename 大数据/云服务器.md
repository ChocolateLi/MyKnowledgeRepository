# 云服务器

## Linux命令

### 文件相关命令

find文件查找

```shell
find <指定目录><指定条件>
find ./ -name '*.txt' 查找当前目录(含子目录)以.txt文件结尾的
```

查看文件某个文件的属性

```
ls -lh 文件名
```

### 用户管理

**分配账号**

1.创建用户

```
sudo useradd chenli
sudo passwd chenli
```

2.加sudo权限

```
vim /etc/sudoers
%chenli	ALL=(ALL) NOPASSWD:ALL
%chenli ALL=(ALL) NOPASSWD:/bin/ls,/usr/bin,!/usr/bin/passwd root
```



**用户组管理**

原理：针对不同用户分配不同权限，集中管理

理论上Linux系统中的每个用户在创建时都应该有一个对应的用户组，这个组就称之为用户的主组。同时，有些情况下，某个用户需要临时使用某个组的权限，那这个组就称之为这个用户的附属组或附加组(**主组唯一，附加组可以有多个**)。



`/etc/group`文件解析（管理用户组信息文件）

```shell
cat /etc/group

mail:x:12:postfix
组名称:组密码:组ID编号:用户

第1列：用户组的"组名称"
第2列：用户组的"组密码"，使用一个x占位符
第3列：用户组的"组ID编号"
第4列：用户组内的用户信息（如果一个用户的"附属组或附加组"为这个组，则用户名会显示在此位置）
```



`groupadd`添加用户组

```shell
# groupadd [选项]  用户组的组名称
选项说明：
	-g ：代表用户组的组ID编号，自定义组必须从1000开始，不能重复


# groupadd hr
主要功能：在系统中添加一个hr的用户组

# groupadd -g 1100 test
主要功能：在系统中添加一个test的用户组并指定主组编号1100

groupadd -g 1000 DL
说明：在系统中添加一个DL的用户组并指定主组编号1000（DL 表示深度学习组）
```



`groupmod` 用户组的修改

```shell
# groupmod [选项 选项的值] 原来组的组名称
选项说明：
	-g ：gid缩写，设置一个自定义的用户组ID数字，1000以后
	-n ：name缩写，设置新的用户组的名称

# groupmod -n 新用户组名称 旧用户组名称
# groupmod -n szhr hr
主要功能：把hr用户组更名为szhr

# groupmod -g 1003 test
主要功能：把test用户组的组编号由1100更改为1003

#  group -g 1004 -n admin linux
主要功能：把linux的组名称改为admin,且组编号改为1004
```



`groupdel` 用户组删除

```shell
# groupdel 用户组名称

# groupdel test
主要功能：删除test用户组

注意：在Linux操作系统中。如果想删除某个用户组，必须保证这个组不是某个用户的主组。
```



附属组管理

`gpasswd` 对附属组添加修改删除用户

```shell
# gpasswd [选项 选项的值] 用户组的名称
选项说明：
	-a ：添加用户到组，append追加
	-d ：从组中删除成员，delete移除
	-A ：指定管理员，Admin管理员  (gpasswd -A 用户名称 组名称)
	-M ：指定组成员，可以批量添加用户到组中
	
创建3个用户user01~user03，将user01添加到sysadmin组里（附属组）
# useradd user01
# useradd user02
# useradd user03
# groupadd sysadmin
# gpasswd -a user01 sysadmin	(追加且一次追加一个)

把user02、user03添加到sysadmin组中
# gpasswd -M user02,user03 sysadmin	(-M 可以一次增加多个用户，但是会删除组原有用户即为覆盖)

# gpasswd -d 移除的用户名称 附属组名称
# gpasswd -d user03 sysadmin
```



**用户管理**

创建的账号必须密码才能登陆且要有/bin/base权限才可以登录系统。

在创建账号时，需要指定shell类型，默认为/bin/bash（拥有大部分权限）还可以是/sbin/nologin，代表账号创建成功，但是不能用于登录操作系统。



`/etc/passwd` 管理用户信息文件

```shell
# cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
用户名称:用户密码:用户编号:用户组号:备注信息:用户的家目录:shell类型

由上可知，一共拥有7列
第1列："用户名称"
第2列："用户的密码"，使用一个x占位符，真实密码存储在/etc/shadow
第3列：数字，"用户的ID编号"，0，1-999，1000 ~ 60000
第4列：数字，"用户的主组GID编号"
第5列：代表注释信息，useradd -c "备注信息" 用户名称  useradd -c "mysql" mysql
第6列："用户的家目录"，默认在/home/用户名称
第7列：用户可以使用的"Shell类型"，useradd -s /bin/bash或/sbin/nologin 用户名称
```



创建用户

```shell
sudo useradd chenli
sudo passwd chenli

# 常用方法
useradd -g 1000 chenli # 把陈力放在编号为1000的用户组中，是主组
useradd -G anaconda chenli # 这样创建的是附加组

# useradd [选项 选项的值] 用户名称
选项说明：	
	-g ：代表添加用户时指定用户所属组的主组，唯一的组信息（重要）
	-s ：代表指定用户可以使用的Shell类型，/bin/bash或/sbin/nologin
			/bin/bash => 给人使用的（运维工程师）
			/sbin/nologin => 给软件使用的
	-r  指定用户为"系统用户"，如创建一个系统账号mysql

在系统中新建一个linuxuser用户(且默认建立了一个linuxuser用户组)
# useradd linuxuser

指定组编号(假设1000的编号为linux,则账号添加到inux用户组中)，指定使用的shell类型
# useradd -g 1000 -s /sbin/nologin lisi
```

删除用户

```
userdel -r chenli 删除用户及其家目录文件
userdel chenli 删除用户，但不删除其家目录文件
```

新建用户组

```
groupadd groupname
```

将用户添加进工作组

```
usermod -G groupname username
```

用户所归属的用户组查询

```
groups 用户名
```

用户身份切换

```
su命令可以变更其他使用者的身份，需要键入使用者的密码

sudo只允许使用提升的权限运行单个命令，需要在 /etc/sudoers文件中定义
sudo提供了一个编辑该文件的命令：visudo。可以对该文件进行修改
加%代表用户组，ALL=(ALL)表示登录者的来源主机，最后的ALL表示可执行的命令。NOPASSWD代表不需要密码直接可以执行sudo，限制多条命令，一定要写绝对路径，用逗号分开，多行用‘\’，用！代表不能执行
%chenli	ALL=(ALL) NOPASSWD:ALL
%chenli ALL=(ALL) NOPASSWD:/bin/ls,/usr/bin,!/usr/bin/passwd root	

sudo -l 来查看哪些命令是可以执行或禁止的 
```

查询用户命令

```
w 用查询当前在线用户，以及每个用户正在执行的进程
who 显示当前登录的所有用户
last 显示目前与过去登入系统的用户相关信息
lastlog 显示每个用户最后的登录时间
id 查看用户id信息
```

more /etc/passwd 查看用户身份信息文件

```
里面信息展示如下：
用户名称：用户密码：用户id：用户主组id：用户说明：用户家目录：用户默认shell
```

more /etc/group 查看组身份信息

```
里面展示信息如下：
组名称：组密码：组id：组的附加成员
```



### 权限管理

查看文件或者目录权限：`ll`

```shell
[root@0003 home]# ll
总用量 8
drwx------ 3 root   root     4096 10月  4 21:06 anaconda
drwx------ 3 chenli anaconda 4096 10月  4 21:16 chenli

每一行显示一个文件或目录的信息，这些信息包括文件的类型、文件的权限、文件的属主、文件的所属组、文件大小、创建时间和文件名。

-代表一般文件，d代表目录，l代表软链接文件。

读取权限：r，写入权限：w，执行权限：x
```



`chgrp` 修改文件和目录所属组

```
chgrp [-R] 所属组 文件名（目录名）
-R（注意是大写）选项长作用于更改目录的所属组，表示更改连同子目录中所有文件的所属组信息

chgrp -R anaconda anaconda3
说明：修改anaconda3目录的用户组为anaconda
```



`chown` 修改文件和目录的所有者和所属组

```
chown [-R] 所有者 文件或目录
chown [-R] 所有者:所属组 文件或目录

chown -R anaconda:anaconda anaconda3
说明：修改anaconda3目录的用户和用户组为anaconda
```



`chmod` 修改文件或目录的权限

```
chmod [-R] 权限值 文件名
r --> 4
w --> 2
x --> 1

```





### 软件安装

#### RPM（redhat package manager）

RPM软件的安装、删除、更新只有root权限才能使用。



初始化rpm数据库

```
rpm --initdb
rpm --rebuilddb

这两个参数是极为有用的，有时rpm系统出了问题，不能安装和查询，大多是这里出了问题。
/var/lib/rpm目录下的数据库记录所有软件的升级需求，记录所有已经安装的所有软件
```

查询已经安装的软件名

```
rpm -q 软件名  == rpm -qa|grep 软件名

rpm -qa 查看系统中所有已经安装的包

rpm -qa|more 分页查看系统中所有已经安装的包
```

查询已安装软件包都安装到何处

```
rpm -ql 软件名
```

查询一个已安装软件包的信息

```
rpm -qi 软件名
```

安装和升级一个rpm包

```
rpm -vih file.rpm 这是用来安装一个新的rpm包
rpm -Uvh file.rpm 这是用来升级一个rpm包
```

删除一个rpm包（先查询后删除）

```
rpm -e 软件名
```

#### yum（yellow dot update modified）

yum镜像地址：

```bash
http://mirrors.aliyun.com/centos/7.9.2009/os/x86_64/
http://mirrors.aliyun.com/epel/7/x86_64/
```

rpm安装软件需要手动解决包之间的依赖关系，yum很好地解决了这个问题，他可以自动解决包之间的依赖关系。



查看rpm是否安装

```
rpm -qa | grep yum
```

yum配置文件，创建容器，位置在/etc/yum.repos.d，扩展名必须是.repo

```
cd /etc/yum.repos.d 
vim yum.repo 	新建一个仓库文件，名字可以随便定义，在文件写如下内容

[base] #代表容器名称，中括号一定要存在，里面的名字可随便取
name=base #说明这个容器的意义，随便写都可以
baseurl=ftp://192.168.0.6/pub/Server #192. 168. 0. 6 是你的 YUM 源地址，这个很重要。 
enabled=1 #是否启动，=0 则不启动，不启动就无法使用该源
gpgcheck=0 #是否验证. 可不要 
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release #验证的密钥. 可不要

# 私服
[nexus]
name=nexusrepo
baseurl=http://172.16.200.77:8081/repository/yum-group/
enabled=1
gpgcheck=0
gpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7

# 外网配置
[base] 
name=base
baseurl=http://mirrors.aliyun.com/centos/7.9.2009/os/x86_64/
enabled=1
gpgcheck=0
```

安装软件

```
yum install
```

删除软件

```
yum remove
```

列出已经安装的软件

```
yum list install
```

执行yum命令如果提示这个

```
This system is not registered with an entitlement server. You can use subscription-manager to register.

[root@localhost ~]# vim /etc/yum/pluginconf.d/subscription-manager.conf
[main]
enabled=0           #将它禁用掉

```



### 进程管理

**进程的属性**

进程ID(PID)：唯一的数值，用来区分进程

父进程ID(PPID)

启动进程的用户ID(UID)和所归属的组(GID)

进程状态：运行R、休眠S、僵尸Z



**ps**

ps为我们提供了一次性查看进程，想要对进程时间监控应用top命令

ps aux

```
USER	表示启动进程用户
PID	表示进程标志号
%CPU 表示运行该进程占用CPU的时间与该进程总的运行时间的比例
%MEM 表示该进程占用内存和总内存的比例
VSZ	表示占用的虚拟内存大小，以KB为单位。
RSS 表示进程占用的物理内存值，以KB为单位
TTY 表示该进程建立时所对应的终端，？表示该进程不占用终端
STAT 表示进程的运行状态，包括一下几种代码：
			D	不可中断的睡眠
			R 就绪（在可运行队列中）
			S 睡眠
			T 被跟踪或停止
			Z 终止（僵尸）的进程
			W 没有足够的内存分页可分配
			< 高优先序进程
			N 低优先序进程
			L	有内存分页分配并锁在内存体内
START	为进程开始时间
TIME 执行的时间
COMMAND 对应的命名名
```

可以用｜管道和more连接起来分页查看

```
ps -aux|more 
```

把所有进程显示出来，并输出到ps001.txt文件中，然后用more来分页查看

```
ps -aux > ps001.txt
more ps001.txt
```

和grep结合，提取指定程序的进程

```
ps -aux | grep httpd
```

父进程和子进程的关系友好判断

```
pa -auxf|grep httpd
这里用到了f参数；父与子关系一目了然
```

找出内存消耗最多的前10名进程

```
ps -auxf|sort -nr -k 4|head -10
```

找出使用CPU最多的前10名进程

```
ps -auxf | sort -nr -k 3|head -10
```

Pstree 命令列出当前的进程，以及他们的树状结构

top命令显示的内容解释

```
第一行表示的项目依次为当前时间、系统启动时间、当前系统登录的用户数、平均负载
第二行显示的是Tasks:total 进程总数、running正在运行的进程数、sleeping睡眠的进程数、stop停止的进程数、zombie僵尸进程数
第三行显示的是目前cpu的使用情况，CPUS:us用户空间占用cpu百分比、sy内核空间占用cpu百分比、ni用户进程空间内改变过优先级的进程占用cpu			百分比、id空闲cpu百分比、wa等待输入输出的cpu时间百分比
第四行显示物理内存使用情况，Mem:total物理总内存量、use使用的物理内存、free空闲内存情况、buffers用作内核缓存的内存量
第五行显示交换区使用情况，Swap
第六行显示参数，下列列出解释
PID:进程标志号
USER:进程所有者的用户名
PR:进程的优先级别，值越小优先级越高
NI:进程优先级别数值 -20～20，正值优先级低，负值优先级高，零表示不会调整该进程的优先级
VIRT:进程占用的虚拟内存值
RES:进程占用的物理内存值
SHR:进程使用的共享内存值
STAT：进程的状态，S表示休眠、R表示正在运行、Z表示僵死状态、N表示该进程优先值是负数
%CPU:该进程占用的CPU使用率
%MEM:该进程占用的物理内存和总内存占比
TIME:该进程启动后占用CPU时间
COMMAND：进程启动的启动命令名称
```

内存监控

```
free -m
-m	表示MB为单位显示内存使用情况
```

### 网络管理

[linux查看服务器带宽以及网络使用情况](https://blog.csdn.net/qq_21267357/article/details/126619876)

### VIM编辑器

```
i:当前字符的左边插入
l:当前字符的行首插入
a:当前字符的右边插入
A:当前行尾插入
o:在当前行下面插入新行
O:在当前行上面插入新行

ctrl+f 向下翻页
ctrl+b 向上翻页

G:移动到文件最后一行
gg:移动到文件第一行

dd:删除整行
yy：复制光标所在行
p:将复制的数据在光标下一行粘贴
P:将复制的数据在光标上一行粘贴
u:撤销前一个操作

:w 保存数据
:wq 保存退出
:q! 不保存退出
:w 文件名 			相当于另存为
```

### 防火墙

如果防火墙开启，我们ping Linux服务器的IP会ping不通，所以我们要对防火墙进行设置。

systemctl是CentOS7的服务管理工具中主要的工具，它融合之前service和chkconfig的功能于一体。

查看防火墙状态

```shell
systemctl status firewalld

firewall-cmd --state //查看防火墙状态
```

启动防火墙

```shell
systemctl start firewalld
```

停止防火墙

```shell
systemctl disable firewalld
```

禁用防火墙

```shell
systemctl stop firewalld
```

开放端口 如80

```shell
开放端口
firewall-cmd --zone=public --add-port=80/tcp --permanent
重新载入
firewall-cmd --reload
查看端口
firewall-cmd --zone=public --query-port=80/tcp
删除端口
firewall-cmd --zone=public --remove-port=80/tcp --permanent
```

/sbin/iptables -I INPUT -p tcp --dport 8887 -j ACCEPT

firewall-cmd --zone=public --add-port=8887/tcp --permanent

### 查看系统常用配置

查看CPU信息

```shell
cat /proc/cpuinfo
```

查看环境变量

```shell
env
```

查看实时运行程序资源占用情况

```
top

q退出
```



查看进程号

```
ps -ef|grep 特定进程

kill -9  进程号
```

查看端口

```
netstat -antp | grep 端口号
```

列出目录所占空间

```
du -sh 显示当前目录大小
du -sh / 显示/目录下的所有目录大小 
```

查看linux系统是ubuntu还是centos以及版本

```
lsb_release -a

cat /etc/centos-release

hostnamectl

cat /etc/os-release 


```



### linux 程序安装目录/opt目录和/usr/local目录的区别

/opt目录用来安装附加软件包，是用户级的程序目录，可以理解为D:/Software。这里可以用于放置第三方大型软件（或游戏）

/usr：系统级的目录，可以理解为C:/Windows/

/usr/local：用户级的程序目录，可以理解为C:/Progrem Files/。用户自己编译的软件默认会安装到这个目录下

自定义的脚本(scripts)放到/usr/local目录下面



### 配置环境变量

**环境变量分类**

用户级别的：~/.bashrc、~/.profile

系统级别的：/etc/bashrc、/etc/profile

**Linux加载环境变量顺序**

/etc/profile

~/.profile

~/.bashrc



### linux常用命令

bash命令：对带有“.sh”扩展名的vi编辑器等文本的处理并执行

```
bash hello.sh
```

查看内存大小

```
free -m
free -g
```

查看硬盘大小

```
df -h
```

查看端口号是否被占用

```
lsof -i:8888
```





### JDK环境变量

1、vi /etc/profile

2、在profie文件末尾添加jdk路径：

​		##JAVA_HOME

​		export JAVA_HOME=/opt/module/jdk1.7.0_79

​		export PATH=$PATH:$JAVA_HOME/bin

3、source  /etc/profile



### 查看GPU命令

**概览**

nvidia-smi是nvidia 的系统管理界面 ，其中smi是System management interface的缩写，它可以收集各种级别的信息，查看显存使用情况。此外, 可以启用和禁用 GPU 配置选项 (如 ECC 内存功能)



说明：

显存：用来存储显卡芯片处理过或即将提取的渲染数据。显存主要存储要处理的图形信息。

ECC内存：ECC是“Error Checking and Correcting”的简写，中文名称是“错误检查和纠正”。能够实现错误检查和纠正技术（ECC）的内存条。一般多应用在服务器及[图形工作站](https://baike.baidu.com/item/图形工作站/7557182?fromModule=lemma_inlink)上，这将使整个[电脑系统](https://baike.baidu.com/item/电脑系统/10467448?fromModule=lemma_inlink)在工作时更趋于安全稳定。



**命令**

`nvidia-smi`

功能：显示当前GPU所有信息

![](https://img-blog.csdn.net/20181010103711710)

```
解释相关参数含义：

GPU：本机中的GPU编号

Name：GPU 类型

Persistence-M：

Fan：风扇转速

Temp：温度，单位摄氏度

Perf：表征性能状态，从P0到P12，P0表示最大性能，P12表示状态最小性能

Pwr:Usage/Cap：能耗表示

Bus-Id：涉及GPU总线的相关信息；

Disp.A：Display Active，表示GPU的显示是否初始化

Memory-Usage：显存使用率

Volatile GPU-Util：浮动的GPU利用率

Uncorr. ECC：关于ECC的东西

Compute M.：计算模式

Processes 显示每块GPU上每个进程所使用的显存情况。
```



`nvidia-smi -L`

功能：列出所有可用的nvidia设备



`nvidia-smi -q`

功能：查看当前所有GPU的信息，也可以通过参数i指定具体的GPU

![](https://img-blog.csdn.net/20181010103712690)

![](https://img-blog.csdn.net/20181010103711880)

![](https://img-blog.csdn.net/20181010103711936)



ps -f -p pid 查看谁在用cpu



查看一台服务器上所有显卡上的使用者和GPU占用情况

1.需要安装gpustat

```
pip install gpustat
```

2.使用以下命令

```
watch -n 3 --color gpustat --c
```

ctrl+c可退出



实时刷新

```
watch -n 1 -d nvidia-smi
```





### Linux机器之间的文件转移

scp就是security copy，用于将文件或者目录从一个Linux系统拷贝到另一个Linux系统下。scp传输数据用的是SSH协议，保证了数据传输的安全，其格式如下：

```shell
scp 本地Linux系统文件路径 远程用户名@IP地址：远程系统文件绝对路径名

scp /etc/nginx/ root@192.168.48.136:/etc
如果拷贝的文件包含子目录，需要加上 -r 
scp -r /etc/nginx/ root@192.168.48.136:/etc

scp -r /home/chenli/pre_model/20221108/checkpoint-14400 chenli@139.9.53.25: /home/chenli/pre_model

scp -r /home/chenli/pre_model/20221108/checkpoint-14400 chenli@139.9.53.25:/home/chenli/pre_model

scp -r /home/chenli/pre_model/best_model chenli@124.71.44.99:/home/chenli/pre_model

scp -r /home/chenli/pre_model/experiment_model chenli@124.71.44.99:/home/chenli/pre_model

scp -r ./epoch_9_valid_acc_97.7_model_weights.bin chenli@124.71.44.99:/home/chenli/pre_model/experiment_model/Longformer+BiGRU/hidden_size_768

scp -r ./BERT chenli@124.71.44.99:/home/chenli/pre_model/2023

scp -r ./Longformer_BiGRU_hidden_size_768 chenli@124.71.44.99:/home/chenli/pre_model/2023

scp -r ./epoch_3_valid_acc_95.6_model_weights.bin chenli@124.71.44.99:/home/chenli/pre_model/2023/Longformer_BiGRU_hidden_size_768/dropout=0

scp -r ./epoch_1_valid_acc_94.5_model_weights.bin chenli@124.71.44.99:/home/chenli/pre_model/2023/BERT/BERT_LongText_Sentiment

```



## 配置集群ssh免密码登录



1、在三台机器的/etc/hosts文件中，都配置对三台机器的ip-hostname的映射

2、首先在三台机器上配置对本机的ssh免密码登录

生成本机的公钥，过程中不断敲回车即可，ssh-keygen命令默认会将公钥放在/root/.ssh目录下

ssh-keygen -t rsa

将公钥复制为authorized_keys文件，此时使用ssh连接本机就不需要输入密码了

cd /root/.ssh

cp id_rsa.pub authorized_keys

3、接着配置三台机器互相之间的ssh免密码登录

使用ssh-copy-id -i spark 命令将本机的公钥拷贝到指定机器的authorized_keys文件中（方便好用）

ssh-copy-id -i  root@192.168.1.102



host文件：

192.168.1.115 sparkproject1
192.168.1.117 sparkproject2
192.168.1.118 sparkproject3



## Hadoop集群搭建

### hadoop安装

把文件上传到 /opt/software目录下

然后解压到 /opt/module目录下

解压命令：tar -zxvf  文件名  -C  目标路径



**将Hadoop添加到环境变量中**

1、vi /etc/profile

2、\##HADOOP_HOME

​	export HADOOP_HOME=/opt/module/hadoop-3.1.3

​	export PATH=$PATH:$HADOOP_HOME/bin

​	export PATH=$PATH:$HADOOP_HOME/sbin

3、source /etc/profile



### 集群规划

注意：NameNode和SecondaryNameNode不要安装在同一台服务器

注意：ResourceManager也很消耗内存，不要和NameNode、SecondaryNameNode配置在同一台机器上

但是我目前只有两台云服务器，所以我把NameNode和ResourceManager放在一起

|      | hadoop1                    | hadoop2                     |
| ---- | -------------------------- | --------------------------- |
| HDFS | NameNode、DataNode         | SecondaryNameNode、DataNode |
| YARN | ResourManager、NodeManager | NodeManager                 |

### 配置文件

**配置core-site.xml**

```
<property>
        <name>fs.defaultFS</name>
        <value>hdfs://hadoop1:8020</value>
</property>
<property>
        <name>hadoop.tmp.dir</name>
        <value>/opt/module/hadoop-3.1.3/data</value>
</property>
```

**配置hdfs-site.xml**

```
<configuration>
    <property>
        <name>dfs.namenode.secondary.http-address</name>
        <value>hadoop2:9868</value>
    </property>
    
    <property>
         <name>dfs.name.dir</name>
         <value>/opt/module/hadoop-3.1.3/data/namenode</value>
    </property>

    <property>
         <name>dfs.data.dir</name>
         <value>/opt/module/hadoop-3.1.3/data/datanode</value>
    </property>

    <property>
         <name>dfs.tmp.dir</name>
         <value>/opt/module/hadoop-3.1.3/data/tmp</value>
    </property>

    <property>
         <name>dfs.replication</name>
         <value>1</value>
    </property>
</configuration>
```

**配置mapred-site.xml**

```
<property>
        <name>mapreduce.framework.name</name>
        <value>yarn</value>
</property>
<!-- 历史服务器端地址 -->
<property>
    <name>mapreduce.jobhistory.address</name>
    <value>hadoop1:10020</value>
</property>

<!-- 历史服务器web端地址 -->
<property>
    <name>mapreduce.jobhistory.webapp.address</name>
    <value>hadoop1:19888</value>
</property>
```

**配置yarn-site.xml**

```
<property>
     <name>yarn.resourcemanager.hostname</name>
     <value>hadoop1</value>
</property>

<property>
     <name>yarn.nodemanager.aux-services</name>
     <value>mapreduce_shuffle</value>
</property>
```

**修改slaves(或者workers)**

```
hadoop1
hadoop2
```

### 启动hdfs集群

1、**（第一次启动才要）**格式化namenode：在hadoop1上执行以下命令：hdfs namenode -format

2、启动hdfs集群：start-dfs.sh
3、验证启动是否成功：jps、50070端口

hadoop1：namenode、datanode

hadoop2：secondarynamenode、datanode

4、hdfs dfs -put hello.txt /hello.txt



**注**：如果集群是第一次启动，需要在hadoop1节点格式化NameNode（注意格式化之前，一定要先停止上次启动的所有namenode和datanode进程，然后再删除data和log数据）



### 启动yarn集群

在配置了ResourceManager的节点（hadoop1启动YARN集群）

1、启动yarn集群：start-yarn.sh
 2、验证启动是否成功：jps、8088端口

haoop1：resourcemanager、nodemanager

hadoop2：nodemanager



### 启动历史服务器

在hadoop1启动历史服务器

```shell
mapred --daemon start historyserver
```

### 错误总结

1、hadoop-3.1.0启动hadoop集群时还有可能可能会报如下错误

```shell
[root@localhost sbin]# start-all.sh
Starting namenodes on [hadoop]
ERROR: Attempting to operate on hdfs namenode as root
ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting operation.
Starting datanodes
ERROR: Attempting to operate on hdfs datanode as root
ERROR: but there is no HDFS_DATANODE_USER defined. Aborting operation.
Starting secondary namenodes [hadoop]
ERROR: Attempting to operate on hdfs secondarynamenode as root
ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting operation.
2018-07-16 05:45:04,628 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Starting resourcemanager
ERROR: Attempting to operate on yarn resourcemanager as root
ERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting operation.
Starting nodemanagers
ERROR: Attempting to operate on yarn nodemanager as root
ERROR: but there is no YARN_NODEMANAGER_USER defined. Aborting operation.
```

解决办法：在 /etc/profile文件下添加以下内容

```shell
export HDFS_NAMENODE_USER=root
export HDFS_DATANODE_USER=root
export HDFS_SECONDARYNAMENODE_USER=root
export YARN_RESOURCEMANAGER_USER=root
export YARN_NODEMANAGER_USER=root
```

2、启动hadoop，报错Error JAVA_HOME is not set and could not be found

其实环境都装好了，还是报错

解决办法：在hadoop-env.sh文件中添加以下配置

```shell
export JAVA_HOME=/opt/module/jdk1.8.0_212
```

3、Hadoop集群环境——启动时报错“java.net.BindException: Cannot assign requested address

```
那么具体的解决办法就是：
1.在Master服务器上，要将自己的ip设置成内网ip，而将另一台Slave服务器的ip设置成外网ip；
2.同样的在Slave服务器上，要将自己的ip设置成内网ip，而将另一台Master服务器的ip设置成外网ip

把core-site.xml里<name>fs.defaultFS</name>的<value>里的服务器ip地址改为localhost，就没报该错了

搭建云服务器上的集群时尤其要注意这一点，不然namenode和secondarynamenode的配置文件要修改为localhost。自己主机上的要修改为localhost，其他主机可以不用。
```

4、在Hadoop3.x上执行MapReduce程序时，报出如下错误

```
Error: Could not find or load main class org.apache.hadoop.mapreduce.v2.app.MRAppMaster
 
Please check whether your etc/hadoop/mapred-site.xml contains the below configuration:
<property>
  <name>yarn.app.mapreduce.am.env</name>
  <value>HADOOP_MAPRED_HOME=${full path of your hadoop distribution directory}</value>
</property>
<property>
  <name>mapreduce.map.env</name>
  <value>HADOOP_MAPRED_HOME=${full path of your hadoop distribution directory}</value>
</property>
<property>
  <name>mapreduce.reduce.env</name>
  <value>HADOOP_MAPRED_HOME=${full path of your hadoop distribution directory}</value>
</property>
```

mapred-site.xml配上这些文件

```
 <property>
    <name>yarn.app.mapreduce.am.env</name>
    <value>HADOOP_MAPRED_HOME=$HADOOP_HOME</value>
 </property>
 <property>
    <name>mapreduce.map.env</name>
    <value>HADOOP_MAPRED_HOME=$HADOOP_HOME</value>
  </property>
  <property>
    <name>mapreduce.reduce.env</name>
    <value>HADOOP_MAPRED_HOME=$HADOOP_HOME</value>
  </property>
```

5、yarn 8088端口访问不了情况

解决办法：修改配置文件yarn-site.xml

```shell
<property>
       <name>yarn.resourcemanager.hostname</name>
       <value>localhost</value>
  </property>

  <property>
       <name>yarn.nodemanager.aux-services</name>
       <value>mapreduce_shuffle</value>
  </property>

  <property>
          <name>yarn.resourcemanager.address</name>
          <value>0.0.0.0:8032</value>
   </property>
   <property>
          <name>yarn.resourcemanager.scheduler.address</name>
          <value>0.0.0.0:8030</value>
   </property>
   <property>
          <name>yarn.resourcemanager.resource-tracker.address</name>
          <value>0.0.0.0:8031</value>
   </property>
   <property>
          <name>yarn.resourcemanager.admin.address</name>
          <value>0.0.0.0:8033</value>
   </property>
   <property>
          <name>yarn.resourcemanager.webapp.address</name>
          <value>0.0.0.0:8088</value>
  </property>
```



## MySQL5.7安装

参考资料：[linux系统安装mysql5.7](https://www.cnblogs.com/xsge/p/13827288.html)

### Centos安装步骤

1、检查是否安装mysql

```shell
rpm -qa | grep mysql

rpm -e mysql　　　　　　　　// 普通删除模式
rpm -e --nodeps mysql　　// 强力删除模式，如果使用上面命令删除时，提示有依赖的其它文件，则用该命令可以对其进行强力删除
```

2、yum安装mysql

**安装mysql源**

CentOS 7的yum源中默认没有mysql，要先下载mysql的repo源

yum源的获取方式：

访问[MySQL官网](https://www.mysql.com/)——选择downloads——MySQL Community (GPL) Downloads》——MySQL Community Server

downloads在导航栏一般比较明显。MySQL Community (GPL) Downloads》一般在页面底部考上位置。MySQL Community Server自己找吧

mysql5.7下载链接

```
https://dev.mysql.com/get/mysql80-community-release-el7-4.noarch.rpm
```

下载mysql的yum源(wget命令用来从指定的URL下载文件)

```shell
wget https://dev.mysql.com/get/mysql80-community-release-el7-4.noarch.rpm
```

软件安装

```shell
rpm -vih mysql80-community-release-el7-4.noarch.rpm
```

检测是否已经成功安装了yum源

```shell
yum  repolist  enabled | grep "mysql.*-community.*"
```

**选择安装版本**

当你使用此方法进行安装MySQL的时候，会默认安装mysql的最新稳定版本（在我现在安装的时候，最新版本为MySQL 8.0 Community Server ）。如果这就是你想要安装的，那么你就可以忽略这步了。如果想要安装以前的版本，比如5.6或者5.5，那么就可以用下面的方法来配置了。



先查看MySQL的那些源被禁用或者启用了

```shell
yum repolist all | grep mysql

mysql-cluster-7.5-community/x86_64  MySQL Cluster 7.5 Community     禁用
mysql-cluster-7.5-community-source  MySQL Cluster 7.5 Community - S 禁用
mysql-cluster-7.6-community/x86_64  MySQL Cluster 7.6 Community     禁用
mysql-cluster-7.6-community-source  MySQL Cluster 7.6 Community - S 禁用
mysql-cluster-8.0-community/x86_64  MySQL Cluster 8.0 Community     禁用
mysql-cluster-8.0-community-source  MySQL Cluster 8.0 Community - S 禁用
mysql-connectors-community/x86_64   MySQL Connectors Community      启用:    221
mysql-connectors-community-source   MySQL Connectors Community - So 禁用
mysql-tools-community/x86_64        MySQL Tools Community           启用:    135
mysql-tools-community-source        MySQL Tools Community - Source  禁用
mysql-tools-preview/x86_64          MySQL Tools Preview             禁用
mysql-tools-preview-source          MySQL Tools Preview - Source    禁用
mysql57-community/x86_64            MySQL 5.7 Community Server      禁用
mysql57-community-source            MySQL 5.7 Community Server - So 禁用
mysql80-community/x86_64            MySQL 8.0 Community Server      启用:    301
mysql80-community-source            MySQL 8.0 Community Server - So 禁用
```

比如我们看到现在启用的是8.0版本系列的。我们需要安装的是5.x系列的。那么我们就可以执行以下命令

```
yum-config-manager --disable mysql80-community　　　　　　 ##禁用8.0版本的
yum-config-manager --enable mysql57-community　　　　　　　##启用5.7版本的（当然启用哪个版本你自己定）　
```

上面的命令执行如果提示：-bash: yum-config-manager: 未找到命令　

那么我们就需要安装执行以下命令来安装一个包

```shell
yum install -y yum-utils
```

查看当前系统配置，仅显示启用MySQL命令

```shell
yum repolist enabled | grep mysql
```

到此为止，yum上已经有mysql5.7的版本的服务了，接下来就进行安装



3、使用yum命令进行安装

```shell
yum install mysql-community-server
```

4、mysql命令管理

```shell
service mysqld start　　　　　　　　#开启MySQL服务　　　　只要没有错误信息就表示已经正常启动了。
service mysqld stop　　　　　　　　#关闭MySQL服务
service mysqld restart　　　　　　#重启MySQL服务 
service mysqld status　　　　　　#查看服务状态
```

5、mysql密码问题

本次安装的MySQL没有设置密码，但系统赋予了默认的且临时的密码，打开mysql默认日志文件/var/log/mysqld.log，可以查看（前提，你刚刚安装好MySQL，且没有重复重启服务）

打开日志查看（,l1srghnftPK）

```
cat /var/log/mysqld.log
```

搜索临时密码，在日志文件中定位

```
grep 'temporary password' /var/log/mysqld.log
```

拿到密码后可以进行登录，但是当我们执行SQL命令时就会报错（提示我们必须先重置密码）

```
mysql -uroot -p,l1srghnftPK
```

先重置密码

MySQL的密码策略比较复杂。这个插件要求密码至少包含一个大写字母，一个小写字母，一个数字和一个特殊字符，并且密码长度至少8个字符。

```
set password = password('MySQL5.7');
```

6、禁止更新

我们在安装之后，为了能够正常运行，我们会禁止MySQL进行更新。因为在yum更新了MySQL之后，MySQL会自动重启，这对于我们上线部署项目来说是没有必要的，所以我们可以屏蔽更新。

```
vim /etc/yum.conf

添加以下信息
exclude=mysql-community-client,mysql-community-common,mysql-community-libs,mysql-community-server
```

7、防火墙设置

创建用户并给用户授权：允许在任意IP登录

Linux中的数据库MySQL，root账户默认只能在本机（Linux系统中）访问。（我们不建议直接修改root用户的信息）

```mysql
#创建用户xsge，密码SQLxsge1.  授权所有权限（all），允许正在任意主机登录（%），任意库任意表（*.*）
grant  all  on  *.*  to  'chenli'@'%'  identified  by  'ChenLi?5.7';　　　　
```

开启防火墙mysql 3306端口的外部访问

```mysql
#设置防火墙开放端口
firewall-cmd --zone=public --add-port=3306/tcp --permanent

#重启防火墙
service firewalld  restart
```

8、数据库乱码

查看编码

```mysql
show variables like 'character_set%';
```

修改mysql配置文件/etc/my.cnf

```mysql
vim  /etc/my.cnf
```

添加如下配置：（注意下图中配置的所在位置，不要乱了，否则可能无法启动数据库服务了）

```mysql
[mysqld]
character-set-server=utf8 
[client]
default-character-set=utf8 
[mysql]
default-character-set=utf8
```

重启MySQL服务，再次查看编码

```mysql
service mysqld restart    #重启MySQL服务

show variables like 'character_set%';
```



### Ubuntu 安装步骤



### linux-aarch46 安装步骤

[安装mysql5.7](https://www.pudn.com/news/62abeb73ca7ee606dccbad66.html)

1.连接服务器

2.root用户下：添加mysql用户组和mysql用户

```
groupadd -r mysql && useradd -r -g mysql -s /sbin/nologin -M mysql
```

3.安装依赖库

```
yum install -y libaio*
```

4.进入/usr/local
下载Mysql：

```
wget https://obs.cn-north-4.myhuaweicloud.com/obs-mirror-ftp4/database/mysql-5.7.27-aarch64.tar.gz
```

解压：tar -xvf mysql-5.7.27-aarch64.tar.gz

5.配置Mysql

```shell
mv /usr/local/mysql-5.7.27-aarch64 /usr/local/mysql

mkdir -p /usr/local/mysql/logs

chown -R mysql:mysql /usr/local/mysql

ln -sf /usr/local/mysql/my.cnf /etc/my.cnf

cp -rf /usr/local/mysql/extra/lib* /usr/lib64/

mv /usr/lib64/libstdc++.so.6 /usr/lib64/libstdc++.so.6.old

ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6
```

6.设置开机启动

```shell
cp -rf /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld

chmod +x /etc/init.d/mysqld

systemctl enable mysqld
```

\7. 添加环境变量

```
vim /etc/profile

​    键盘输入“i”，开启编辑模式

​    添加下面两行代码：
​    export MYSQL_HOME=/usr/local/mysql
​    export PATH=$PATH:$MYSQL_HOME/bin

​    保存退出：Esc键  再输入  ：wq 

source /etc/profile
```

8.初始化启动mysql

```
//无密码初始化登录
mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
```

9.开启mysql

```
systemctl start mysqld
```

10.查看状态

```shell
systemctl status mysqld
```

//出现以下说明安装成功

![img](https://img-blog.csdnimg.cn/50c7a269eed548fa82e0d53f1e7296f4.png)

 11.修改密码（因为初始化时设置无密码登录）

进入mysql安装路径的bin目录下：cd /usr/local/mysql/bin

执行  ./mysql -u root -p

```mysql
mysql>SET PASSWORD = PASSWORD('123456'); // 设置密码123456

mysql>ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;

mysql>use mysql;                    

mysql>update user set host = '%' where user = 'root'; 

mysql>FLUSH PRIVILEGES;

mysql>exit
```

### mysql相关命令

查看mysql服务状态

```shell
service mysql status
```

关闭mysql服务

```shell
service mysql stop
```

查找与mysql相关的目录

```
find / -name mysql
或：whereis mysql
```

删除mysql配置文件

```shell
rm  -rf   /etc/my.cnf
rm  -rf   /etc/init.d/mysqld
```

查询所有用户

```sql
use mysql;
select Host,User from user;
```

用户相关命令

```mysql
查询所有用户
select Host,User,Password from user;

查询用户权限：all表示所有权限，select表示只查权限，update表示只改权限，delete表示只删权限等。
show grants for "user"@"host";
show grants for "root"@"localhost";

添加授权用户(新创建的用户，默认情况下是没有任何权限的)：使用root用户连接到服务器
create user "用户名"@"IP地址" identified by "密码";
create user "haidon"@"%" identified by "123456";
create user "haidon"@"localhost" identified by "123456";
IP地址的表示方式：
1.% 表示用户可以从任何地址连接到服务器
2.localhost 表示用户只能从本地连接到服务器
3.指定一个ip表示用户只能从此ip连接到服务器

分配用户权限(给用户授权)
grant 权限列表 on 库.表 to "用户名"@"ip地址" with grant option;
grant all privileges on *.* to "haidon"@"%" with grant option;
grant all privileges on *.* to "haidon"@"%" identified by 'test' with grant option; 
grant all privileges on domain_check.tb_user to "haidon"@"localhost" with grant option;
grant select on domain_check.tb_user to "haidon"@"localhost" with grant option;
grant select,insert on domain_check.tb_user to "haidon"@"132.24.98.25" with grant option;  
1.权限列表：select、update、delete、insert、alter、drop、create、...(show)
2.库.表：*.*表示所有库的所有表。with grant option表示它具有grant权限。密码是test。 
3.如果带了 with grant option，那么用户haidon可以将select ,update权限传递给其他用户( 如xiaodon)。
4.如果没带 with grant option，那么用户haidon不能给用户xiaodon授权。
5.all后面加上privileges，具体到哪些权限时得看MySQL版本，5.7版本不加privileges，8.0版本加privileges。
6.insert into user values("%","haidon",password("test"),"Y","Y","Y","Y","Y","Y","Y","Y","Y","Y"); 
flush privileges; 这两句和上面第3句grant的效果是一样的。
7.insert into user (host,user) values("132.24.98.25","haidon");
  insert into db values("132.24.98.25","haidon","Y","Y","Y","Y","Y","Y","N","N","N","N") 
  flush privileges; 这三句和上面第6句grant的效果是一样的。
  
收回用户权限
revoke all on *.* from "haidon"@"localhost";
revoke all on domain_check.tb_user from "haidon"@"localhost";
revoke select  on *.* from "haidon"@"localhost";

删除授权用户
drop user "用户名"@"ip地址"
drop user "haidon"@"%"
delete from user where user='haidon'; 
flush privileges;
```



### Mysql数据库备份与还原

**使用mysqldump命令进行备份**

mysqldump命令可以将数据库中的数据备份成一个文本文件。表的结构和表中的数据将存储在生成的文本文件中。

基本语法

```shell
mysqldump -u username -p dbname table1 table2 ...> BackupName.sql

dbname参数表示数据库的名称；
table1和table2参数表示需要备份的表的名称，为空则整个数据库备份；
BackupName.sql参数是备份文件的名称，文件名前面可以加上一个绝对路径。通常将数据库被分成一个后缀名为sql的文件；
```

范例：使用root用户备份myblog数据库下的user表

```
mysqldump -u root -p myblog user > /home/backup.sql

mysqldump -u root -p spider data > /home/chenli/backup.sql
```

同时备份多个数据库

```
mysqldump -u username -p --databases dbname2 dbname2 > Backup.sql

加上--databases选项，然后在后面同时指定多个数据库，比如：
mysqldump -u root -p --databases myblog mysql > /home/backup.sql
```

备份所有数据库

```
mysqldump -u username -p -all-databases > /home/BackupName.sql
```

**数据还原**

```
mysql -u root -p [dbname] < backup.sql
```



## MySQL 8.0安装

**参考资料**

[Linux环境安装mysql](https://blog.csdn.net/weixin_49080355/article/details/119215545)

[mysql驱动包下载教程](https://blog.csdn.net/test_zhuoran/article/details/131378570)

8.0.33的mysql驱动可以适配8.0.38版本的mysql

**安装步骤**

1.检查是否安装mysql

```shell
rpm -qa | grep mysql

rpm -e mysql　　　　　　　　// 普通删除模式
rpm -e --nodeps mysql　　// 强力删除模式，如果使用上面命令删除时，提示有依赖的其它文件，则用该命令可以对其进行强力删除


# 先检查有没有安装mariadb，有的话卸载，不然会和mysql冲突
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 yum.repos.d]# rpm -qa | grep mysql
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 yum.repos.d]# yum list |grep mariadb
mariadb-libs.x86_64                      1:5.5.68-1.el7            @anaconda/7.9
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 yum.repos.d]# rpm -qa|grep mariadb
mariadb-libs-5.5.68-1.el7.x86_64
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 yum.repos.d]# yum remove mariadb-libs-5.5.68-1.el7.x86_64
```

2.解压到指定位置

```shell
tar -xvf mysql-8.0.38-1.el7.x86_64.rpm-bundle.tar -C /data/app/mysql/
```

3.依次安装以下jar包

```shell
rpm -ivh mysql-community-common-8.0.38-1.el7.x86_64.rpm

rpm -ivh mysql-community-libs-8.0.38-1.el7.x86_64.rpm 

rpm -ivh mysql-community-libs-8.0.38-1.el7.x86_64.rpm 

rpm -ivh mysql-community-libs-compat-8.0.38-1.el7.x86_64.rpm 

rpm -ivh mysql-community-client-8.0.38-1.el7.x86_64.rpm

rpm -ivh mysql-community-icu-data-files-8.0.38-1.el7.x86_64.rpm 

rpm -ivh mysql-community-server-8.0.38-1.el7.x86_64.rpm 
```

4.配置mysql

```shell
vi /etc/my.cnf

datadir=/var/lib/mysql # 着重查看这个
socket=/var/lib/mysql/mysql.sock
log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid

# 查看datadir指向的文件夹下面是否为空，不为空则清空此文件夹。一般是指向/var/lib/mysql
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 etc]# cd /var/lib/mysql
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 mysql]# ls

# 初始化数据库
mysqld --initialize --user=root

# 打开/var/log/mysqld.log,查看root的初始密码。把密码复制下来。
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 mysql]#  cat /var/log/mysqld.log
2024-07-18T01:27:59.668847Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.0.38) initializing of server in progress as process 122656
2024-07-18T01:27:59.676983Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.
2024-07-18T01:27:59.974532Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.
2024-07-18T01:28:00.990447Z 6 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: au?wfJJhL7NV
```

5.启动数据库

```shell
systemctl start mysqld

# 重启数据库命令
systemctl restart mysqld

```

如果报以下错误，这是因为数据库的文件夹权限不够所致。赋权限即可。然后再次运行数据库。

```shell
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 mysql]# systemctl start mysqld
Job for mysqld.service failed because the control process exited with error code. See "systemctl status mysqld.service" and "journalctl -xe" for details.

chmod -R 777 /var/lib/mysql

# 再次启动
systemctl start mysqld
```

登录数据库：密码就是刚刚查看的随机密码。

```shell
mysql -uroot -p
```

修改密码

```shell
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
EXIT;--可以不退出
```

设置所有ip可以访问

```mysql
update mysql.user set host='%' where user='root';
flush privileges;

mysql> update mysql.user set host='%' where user='root';
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> flush privileges;
Query OK, 0 rows affected (0.00 sec)

```

6.DBeaver连接mysql

```
# url链接
jdbc:mysql://10.201.100.83:3306/?allowPublicKeyRetrieval=true&useSSL=false # 互联网医院测试服务器
jdbc:mysql://10.201.100.75:3306/?allowPublicKeyRetrieval=true&useSSL=false # 大数据服务器
```





## Redis 7.0安装

参考链接：[参考链接](https://blog.csdn.net/qq_54796785/article/details/126028613#:~:text=1.%E9%A6%96%E5%85%88%E6%88%91%E4%BB%AC%E8%BF%9B%E5%85%A5%E6%88%91%E4%BB%AC%E7%9A%84redis%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE%EF%BC%88%E4%B9%8B%E5%89%8D%E4%B8%8A%E4%BC%A0%E7%9A%84%EF%BC%89)

1.检查环境，是否具备gcc环境（redis是基于C语言开发的，所以需要gcc环境）

```shell
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 soft]# gcc -v
bash: gcc: 未找到命令...
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 soft]# gcc --version
bash: gcc: 未找到命令...

# 如果提示gcc不是内部命令，则需要安装。
yum install gcc
```

2.解压redis安装包

```shell
tar -zxvf redis-7.0.4.tar.gz -C /data/app
```

3.进入redis目录使用make命令

```shell
make

    CC cli_common.o
    LINK redis-cli
    CC redis-benchmark.o
    LINK redis-benchmark
    INSTALL redis-check-rdb
    INSTALL redis-check-aof

Hint: It's a good idea to run 'make test' ;)

make[1]: 离开目录“/data/app/redis/src”


# 跳过make test，直接make install
make install

make[1]: 进入目录“/data/app/redis/src”

Hint: It's a good idea to run 'make test' ;)

    INSTALL redis-server
    INSTALL redis-benchmark
    INSTALL redis-cli
make[1]: 离开目录“/data/app/redis/src”

# 进入目录查看
cd /usr/local/bin/
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 bin]# ll
总用量 21484
-rwxr-xr-x. 1 root root  5196592 7月  18 03:32 redis-benchmark
lrwxrwxrwx. 1 root root       12 7月  18 03:32 redis-check-aof -> redis-server
lrwxrwxrwx. 1 root root       12 7月  18 03:32 redis-check-rdb -> redis-server
-rwxr-xr-x. 1 root root  5409784 7月  18 03:32 redis-cli
lrwxrwxrwx. 1 root root       12 7月  18 03:32 redis-sentinel -> redis-server
-rwxr-xr-x. 1 root root 11388936 7月  18 03:32 redis-server


```

4.启动Redis（后台启动）

```shell
# 先备份redis.conf
cp redis.conf /data/backup/

# 修改文件redis.conf，设置daemonize no改成yes
vim redis.conf

daemonize yes # 将No改为yes
```

启动redis

```shell
cd /usr/local/bin/

redis-server /data/app/redis/redis.conf

[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 bin]# redis-server /data/app/redis/redis.conf
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 bin]# ps -ef | grep redis
root     125093      1  0 03:53 ?        00:00:00 redis-server 127.0.0.1:6379
root     125519  10655  0 03:53 pts/0    00:00:00 grep --color=auto redis


```

通过redis-cli连接redis

```shell
[root@server-9404e839-c786-4475-9b4b-3e4cb350d476 bin]# redis-cli 
127.0.0.1:6379> ping
PONG
127.0.0.1:6379> exit# 退出


# 或者直接
redis-cli ping
```

5.关闭redis

```shell
# 先找到进程号
ps -ef | grep redis

# kill掉
kill -9 125093
```



## ES8安装

1.检查java环境

```shell
java -version
```

2.下载对应的[安装包](https://www.elastic.co/cn/downloads/past-releases#elasticsearch)，上传对应的目录并安装

```bash
rpm -ivh elasticsearch-8.8.1-x86_64.rpm

# 安装过程
--------------------------- Security autoconfiguration information ------------------------------

Authentication and authorization are enabled.
TLS for the transport and HTTP layers is enabled and configured.

The generated password for the elastic built-in superuser is : QQtg+hEiUfYmuzM7Be5a

If this node should join an existing cluster, you can reconfigure this with
'/usr/share/elasticsearch/bin/elasticsearch-reconfigure-node --enrollment-token <token-here>'
after creating an enrollment token on your existing cluster.

You can complete the following actions at any time:

Reset the password of the elastic built-in superuser with 
'/usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic'.

Generate an enrollment token for Kibana instances with 
 '/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana'.

Generate an enrollment token for Elasticsearch nodes with 
'/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s node'.

-------------------------------------------------------------------------------------------------
### NOT starting on installation, please execute the following statements to configure elasticsearch service to start automatically using systemd
 sudo systemctl daemon-reload
 sudo systemctl enable elasticsearch.service
### You can start elasticsearch service by executing
 sudo systemctl start elasticsearch.service
```

3.配置es

```bash
cd /etc/elasticsearch/

vi elasticsearch.yml
# 节点名称
node.name: node-1
# 数据路径
#path.data: /var/lib/elasticsearch
path.data: /data/app/es/data
# 日志路径
#path.logs: /var/log/elasticsearch
path.logs: /data/app/es/log
# 网络设置
network.host: 0.0.0.0
http.port: 9200
# 发现和集群配置
cluster.initial_master_nodes: ["node-1"]
# ssl设置为false，否则无法访问
xpack.security.http.ssl:
  enabled: false
  keystore.path: certs/http.p12



```

4.修改系统参数

```bash
vi /etc/security/limits.conf
* soft nofile 65536
* hard nofile 131072
* soft nproc 2048
* hard nproc 4096

vi /etc/sysctl.conf
vm.max_map_count=655360
```

5.创建es管理用户，es无法用root启动的

```bash
# 创建一个叫es的用户组并且设置了一个用户叫es
groupadd es
useradd -g es es

# 设置文件目录权限为es
chown -R es:es /etc/elasticsearch/  											#elasticsearch 配置文件权限
chown -R es:es /usr/share/elasticsearch/ 									# elasticsearch bin权限
chown -R es:es /usr/lib/systemd/system/elasticsearch.service 			 # service启动权限
chown -R es:es /var/lib/elasticsearch										# 数据存放
chown -R es:es /data/app/es/data										# 数据存放
chown -R es:es /var/log/elasticsearch										# 日志存放
chown -R es:es /data/app/es/log										# 日志存放
mkdir /var/run/elasticsearch/
chown -R es:es /var/run/elasticsearch/				#守护进程
chown -R es:es /etc/sysconfig/elasticsearch 		#启动服务的配置文件

# 设置启动用户为es
vim /usr/lib/systemd/system/elasticsearch.service
User=es
Group=es

# 设置服务启动配置
systemctl daemon-reload
systemctl enable elasticsearch.service
```

6.启动并管理es服务

```bash
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch

# 如果修改了配置文件要重新启动
systemctl restart elasticsearch

# 检查服务状态
sudo systemctl status elasticsearch

# 查看es日志
sudo journalctl -u elasticsearch

[root@inter es]# systemctl status elasticsearch
● elasticsearch.service - Elasticsearch
   Loaded: loaded (/usr/lib/systemd/system/elasticsearch.service; enabled; vendor preset: disabled)
   Active: active (running) since 四 2024-07-18 21:56:31 EDT; 9s ago
     Docs: https://www.elastic.co
 Main PID: 179949 (java)
    Tasks: 94
   CGroup: /system.slice/elasticsearch.service
           ├─179949 /usr/share/elasticsearch/jdk/bin/java -Xms4m -Xmx64m -XX:+UseSerialGC -Dcli.name=server -Dcli.script=/usr/share/elasticsearch/bin/elasticsearch -Dcli.libs=lib/tools/server-cli -Des.path.home=/usr/share/elasticsear...
           ├─181735 /usr/share/elasticsearch/jdk/bin/java -Des.networkaddress.cache.ttl=60 -Des.networkaddress.cache.negative.ttl=10 -Djava.security.manager=allow -XX:+AlwaysPreTouch -Xss1m -Djava.awt.headless=true -Dfile.encoding=UT...
           └─183683 /usr/share/elasticsearch/modules/x-pack-ml/platform/linux-x86_64/bin/controller

7月 18 21:54:02 inter systemd[1]: Starting Elasticsearch...
7月 18 21:56:31 inter systemd[1]: Started Elasticsearch.
[root@inter es]# journalctl -u elasticsearch
-- Logs begin at 三 2024-07-17 04:24:49 EDT, end at 四 2024-07-18 21:56:31 EDT. --
7月 18 21:54:02 inter systemd[1]: Starting Elasticsearch...
7月 18 21:56:31 inter systemd[1]: Started Elasticsearch.
[root@inter es]# curl -X GET "10.201.100.83:9200/"
{"error":{"root_cause":[{"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":["Basic realm=\"security\" charset=\"UTF-8\"","ApiKey"]}}],"type":"security_exception","reason":"missing authentication credentials for REST request [/]","header":{"WWW-Authenticate":["Basic realm=\"security\" charset=\"UTF-8\"","ApiKey"]}},"status":401}[root@inter es]# 

```

7.验证安装

```bash
curl -X GET "localhost:9200/"

# 网页端访问
http://10.201.100.83:9200/
```



如果访问不了，需要用户和密码，需要设置一下

1.重置密码（启动服务直接重置就行）

```bash
# 使用 Elasticsearch 提供的密码重置工具。
/usr/share/elasticsearch/bin/elasticsearch-reset-password -u es

./elasticsearch-reset-password -u elastic
1xAbSZIJiTt5qYCvtTSJ
```

2.访问

```bash
curl -u elastic:1xAbSZIJiTt5qYCvtTSJ -X GET "http://10.201.100.83:9200/"
```

3.设置新密码

```bash
curl -u elastic:1xAbSZIJiTt5qYCvtTSJ -X POST "http://localhost:9200/_security/user/elastic/_password" -H "Content-Type: application/json" -d '{
  "password" : "*********"
}'

```

## GO环境安装

1.上传安装包解压到对应目录

```shell
tar -zxvf go1.21.12.linux-amd64.tar.gz -C /data/app/
```

2.添加环境变量

```shell
vi /etc/profile
# 在/etc/profile最后一行添加
export GOROOT=/data/app/go
export PATH=$PATH:$GOROOT/bin
# 保存退出后source一下（vi 的使用方法可以自己搜索一下）
source /etc/profile
```

3.验证环境

```shell
go version
```

[参考链接](https://blog.csdn.net/wltsysterm/article/details/119383406)



## gcc离线安装

1.下载相应的jar包[gcc的jar包](https://niceyoo.lanzoux.com/i5nIdmx2n9e)

2.解压

```shell
 tar -zxvf gcc.tar.gz -C /data/app/gcc/
```

3.安装

```shell
rpm -Uvh *.rpm --nodeps --force
```

4.验证

```shell
gcc -v
```

## python3离线安装

[参考链接](https://zhuanlan.zhihu.com/p/108588745?utm_id=0)

```bash
[root@cesdb python3]# python3
python3: error while loading shared libraries: libpython3.8m.so.1.0: cannot open shared object file: No such file or directory

find /usr -name "libpython3.8m.so.1.0"

sudo vi /etc/ld.so.conf.d/python3.conf
# 在文件中添加包含 libpython3.8m.so.1.0 的目录路径，例如 /usr/local/python3/lib，然后保存文件并退出。

sudo ldconfig

python3 --version
```

## 脚本文件

放在 /usr/local/bin目录下

更改文件权限 chmod 777 文件

### all-jps.sh(查看所有主机的进程)

```shell
#!/bin/bash
for((host=1; host<=2; host++)); do
                echo "================  hadoop$host JPS  ====================="
        ssh hadoop$host "jps"
done
```

### xsync(同步脚本)

如果本机或者远程计算机没有安装 rsync，可以用下面的命令安装

sudo yum install rsync



```shell
#!/bin/bash
#1 获取输入参数个数，如果没有参数，直接退出
pcount=$#
if ((pcount==0)); then
echo no args;
exit;
fi
 
#2 获取文件名称
p1=$1
fname=`basename $p1`
echo fname=$fname
 
#3 获取上级目录到绝对路径
pdir=`cd -P $(dirname $p1); pwd`
echo pdir=$pdir
 
#4 获取当前用户名称
user=`whoami`
 
#5 循环
for((host=1; host<3; host++)); do
        echo ------------------- hadoop$host --------------
        rsync -rvl $pdir/$fname $user@hadoop$host:$pdir
done
```



## 安装Anaconda

1.先查看linux的cpu版本

```
lscpu
```

2.在官网链接中查找自己需要的版本号

```
https://repo.anaconda.com/archive/

自己需要的：https://repo.anaconda.com/archive/Anaconda3-2021.05-Linux-x86_64.sh
https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-aarch64.sh
```

3.在终端中输入命令

```
wget https://repo.anaconda.com/archive/Anaconda3-2021.05-Linux-x86_64.sh
wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-aarch64.sh
```

4.使用bash命令执行anaconda包

```
ls

bash 
```

5.设置 anaconda环境变量

```shell
conda -V	--会报错

vim /home/chenli/.bashrc 
在最后一行添加
# ANACONDA_HOME
export ANACONDA_HOME=/home/chenli/anaconda3
export PATH=$PATH:$ANACONDA_HOME/bin

source ~/.bashrc

conda -V	--安装成功
```

### Anaconda常用命令

1.检查是否安装以及当前版本

```shell
conda -V
```

2.查看安装了哪些包

```shell
conda list
```

3.查看当前存在哪些虚拟环境

```
conda env list
conda info -e
```

4.conda创建虚拟环境

```
conda create -n your_env_name python=x.x

anaconda命令创建python版本为x.x，名字为your_env_name的虚拟环境。your_env_name文件可以在Anaconda安装目录envs文件下找到。

conda create -n pytorch python=3.9
```

5.激活或者切换环境

```
Linux:  source activate your_env_nam
Windows: activate your_env_name

输入python --version检查当前 python 版本
```

6.对虚拟环境安装额外的包

```shell
conda install -n your_env_name [package]
```

7.关闭虚拟环境（返回默认使用的python版本）

```
deactivate env_name
或者`activate root`切回root环境
Linux下：source deactivate 
```

8.删除虚拟环境

```
conda remove -n your_env_name --all
```

9.删除环境钟的某个包

```
conda remove --name $your_env_name  $package_name
```

10.设置国内镜像

```
# 添加Anaconda的TUNA镜像
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/

# 设置搜索时显示通道地址
conda config --set show_channel_urls yes
```

11.恢复默认镜像

```shell
conda config --remove-key channels

--删除镜像地址
conda config --remove channels url地址

--查看镜像
conda config --show
```

 12.查找linux服务器上的python环境

```
先切换到你所想要的conda环境
source activate pytorch

敲下python
python

进入编译器后
import sys
sys.executable

/home/chenli/anaconda3/envs/pytorch/bin/python
```



### Anaconda安装pytorch

1.创建专属pytorch的python环境

```
conda create -n pytorch python=3.7（pytorch 是我自己取的名字）
```

2.激活pytorch环境

```
conda activate pytorch
```

3.检查环境是否装好

```
conda info -e
```

4.查看python版本

```
python --version
```

5.选择版本进行安装

```
1.进入官网
https://pytorch.org/

2.选择合适的版本，复制那句命令
conda install pytorch torchvision torchaudio cudatoolkit=10.2 -c pytorch
pip3 install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cpu

如果conda的不行就选择pip的方式
```

![pytorch环境安装](D:\github\MyKnowledgeRepository\img\machine_learning_img\pytorch环境安装.png)

6.检查是否安装完成

```
python 

import torch
```



### Anaconda安装jupyter notebook

1.先查看是否安装jupyter notebook

```
jupyter notebook
```

2.如果没有安装，使用conda安装

```
pip install jupyter
```

3.安装后生成配置文件，用于后面ip、端口号、密码等

```
jupyter notebook --generate-config
```

4.在根目录下有.jupyter，隐藏文件。使用 `ls -a`查看目录下所有文件

```
cd ~
ls -a
```

5.启动 `ipython` 配置密码。（ipython是python的交互式shell）

```
>>>from notebook.auth import passwd
>>>passwd()
Enter passwd:				# 这里输入你的密码
Verify passwd:				#重复输入密码
>>>argon2:$argon2id$v=19$m=10240,t=10,p=8$YiTF3tI7ZWECTbNaa5VZtA$kaU+xbQSsMaZsH98sqoaGg  #复制这段秘钥

argon2:$argon2id$v=19$m=10240,t=10,p=8$AIC0Y9Gvx8jr12GEXu8d4w$EgC8pV1VUUkNmHlhX6QNSA(chenli)

argon2:$argon2id$v=19$m=10240,t=10,p=8$8JoXOdJkvxNc9OntD5Nr6w$CiW73HzPYxfAaYXyStBkOsOXImFF7ua8rEaSeCCMQZg

'argon2:$argon2id$v=19$m=10240,t=10,p=8$6Lg3woCNsqxXaPidbyNuTQ$m1fGAIu32qGqBLY3EEMPbg'
```

6.开始编辑配置文件

```
vim ~/.jupyter/jupyter_notebook_config.py

在任意位置加如下内容
c.NotebookApp.ip = '*'  #允许任何ip去访问我们的jupyter notebook
c.NotebookApp.password = u'argon2:$argon2id$v=19$m=10240,t=10,p=8$AIC0Y9Gvx8jr12GEXu8d4w$EgC8pV1VUUkNmHlhX6QNSA'  #u后面加上你复制的密钥
c.NotebookApp.open_browser = False    #因为是在linux，就不让他打开浏览器了
c.NotebookApp.port = 8888    #随便指定一个端口，如果这个端口被占用，jupyter会加1重新找端口，直到找到为止
c.NotebookApp.allow_remote_access = True  #允许远程控制
c.NotebookApp.notebook_dir = u'/home/chenli/python/jupyter_file'  #设置你打开jupyter notebook的时候想显示的位置，可以设置成经常使用的路径
#配置完记得保存
```

```
c.NotebookApp.ip = '*'
c.NotebookApp.password = u'argon2:$argon2id$v=19$m=10240,t=10,p=8$6Lg3woCNsqxXaPidbyNuTQ$m1fGAIu32qGqBLY3EEMPbg'
c.NotebookApp.open_browser = False 
c.NotebookApp.port = 8888 
c.NotebookApp.allow_remote_access = True
c.NotebookApp.notebook_dir = u'/home/chenli/jupyter'
c.ServerApp.browser = u'chrome'
```

7.启动jupyter notebook

```
jupyter notebook
#先看一眼8888端口有没有被占用，不然被占用后jupyter会提示并搞一个新端口，记住它
#然后【Ctrl + C】停止，再挂在后台，防止terminal关闭，端口也关闭 

#后台启动
nohup jupyter notebook & 
```

8.在window下远程访问

```
http://address_of_remote:8888
```

**意外情况**

**在windows下远程访问jupyter notebook显示无法正常访问怎么办？**

有些服务器可能只开放一个对外的端口，但是我们通过终端访问服务器需要一个对外端口，开启jupyter服务又需要一个端口，这样就需要同时占用两个端口才行。
 举个例子，服务器为了保证安全性只开放了一个对外的端口，22号端口，我们使用终端通过22号端口登录到服务器上打开jupyter，jupyter创建的端口是8888号，但是服务器没有对外开放8888号端口，所以即使打开了jupyter，外面也无法正常访问。
 如果把jupyter的端口号改为22号，由于我们登录终端的时候正在占用22号，所以jupyter就会提示端口已被占用，无法创建。
 网上有很多教程说可以通过修改防火墙设置来开放端口，修改防火墙设置一般都需要管理员权限，但是通常我们使用服务器的时候大多数情况下是不可能有管理员权限的，这时候我们可以使用**端口映射**来解决这个问题。



在window下打开cmd窗口

```
ssh -N -f -L localhost:9999:localhost:8888 -p 端口号 username@远程地址
-N指SSH没有命令被远程执行；-f指SSH在后台执行；-L指定端口前向映射的配置，远程端口是9999，本地端口是8888
#locahost:9999是指本地地址，localhost:8888是指远程地址，其中8888是在linux我们为jupyter notebook开启的端口
#-p 端口号 username@远程地址是什么后面的看下面截图

#例如：
ssh -N -f -L localhost:9999:localhost:8888 -p 22 chenli@121.37.225.67
#这时候DOS让输入密码，这个密码不是设置jupyter notebook的密码，而是我们登录liunx账户的密码
```

接下来在浏览器端输入以下命令

```
localhost:9999
```

**值得一提**

如果实验室服务器意外重启，需要重新在Linux下启动jupyter notebook，并在DOS下重新映射，只跑下面的代码就可以了

```shell
# 在linux里面运行下面的代码
nohup jupyter notebook &
# 在windows里面运行下面的代码，locahost:9999是指本地地址，localhost:8888是指远程地址
ssh -N -f -L localhost:9999:localhost:8888 -p 22 chenli@124.71.44.99
```



后台执行python文件

```
nohup python main.py > myout.file 2>&1 &
将控制台或者日志记录输出到myout.file文件
```



**jupyter代码自动补全**

1.在终端输入以下代码

```
pip install jupyter_contrib_nbextensions

jupyter contrib nbextension install --user --skip-running-check
```

2.重启jupyter notebook，勾选 “Table of Contents” 以及 “Hinterland”。



**使用 Anaconda 虚拟环境作为jupyter notebook内核**

**安装内核**

1.创建虚拟环境。

```
conda create -n pytorch python=3.7
conda create -n spider python=3.7
```

2.切换到pytorch虚拟环境。

```
conda activate pytorch
conda activate spider
```

3.在pytorch虚拟环境中安装jupyter内核包ipykernel。

```
conda install -n pytorch ipykernel
conda install -n spider ipykernel
```

4.安装内核。其中pytorch为虚拟环境的名称，"pytorch"为内核的显示名称。

```
python -m ipykernel install --user --name pytorch --display-name "pytorch"
python -m ipykernel install --user --name spider --display-name "spider"
```

**删除内核**

1.查看已安装内核

```
jupyter kernelspec list
```

2.删除内核。pytorch为要删除的内核的名字

```
jupyter kernelspec remove pytorch
```

3.验证

```
jupyter kernelspec list
```



**从启动jupyter notebook 到浏览器使用步骤**

1.linux服务器启动 jupyter notebook

```
nohup jupyter notebook &
```

2.window终端执行以下命令

```
ssh -N -f -L localhost:9999:localhost:8888 -p 22 chenli@121.37.225.67
```

3.浏览器输入

```
localhost:9999
```



**linux关闭jupyter**

1.用 ps 命令查看jupyter进程

```
ps -aux | grep jupyter

第一列是user	第二列是PID
```

2.杀死进程

```
kill -9 PID
```



### GPU服务器使用conda环境

1.查看.bashrc文件

```
cd ~ # 切换到自己的家目录
cat .bashrc # 查看环境变量，发现没有conda环境变量
```

2.添加以下conda环境变量内容

```shell
vim .bashrc

# 把下面的内容原封不动的添加到里面
export PATH=/home/anaconda/anaconda3/bin:$PATH
# >>> conda initialize >>>
# !! Contents within this block are managed by 'conda init' !!
__conda_setup="$('/home/anaconda/anaconda3/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/home/anaconda/anaconda3/etc/profile.d/conda.sh" ]; then
        . "/home/anaconda/anaconda3/etc/profile.d/conda.sh"
    else
        export PATH="/home/anaconda/anaconda3/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<
```

3.source一下

```shell
source .bashrc
```

然后就可以使用conda环境了

### win10安装anaconda

参考链接：[windows安装anaconda](https://blog.csdn.net/Natsuago/article/details/143081283)

[jupyter notebook切换python环境](https://blog.csdn.net/u014264373/article/details/86541767)

## 问题

### 1.use内存占用高的问题

1.使用 top 命令，按 shift + m 排序，查看内存占用高的程序 pid

2.使用 kill -9 pid 杀死进程，释放内存

3.free -h 查看内存是否已经释放



### 2.RuntimeError: CUDA out of memory

方法五： 环境变量中加入export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:32

vim ~/.bashrc

export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:32

保存并退出
source ~/.bashrc

















